package com.courtdata.court_data_fetcher.controller;

import com.courtdata.court_data_fetcher.entity.CaseDetails;
import com.courtdata.court_data_fetcher.service.CourtDataService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/cases")
@RequiredArgsConstructor
@CrossOrigin(origins = "http://localhost:3000")
public class CourtDataController {

	private final CourtDataService service;

	@GetMapping("/captcha")
	public ResponseEntity<byte[]> getCaptcha() {
		try {
			byte[] imageBytes = service.getCaptchaImage();
			return ResponseEntity.ok().header("Content-Type", "image/png").body(imageBytes);
		} catch (Exception e) {
			return ResponseEntity.status(500).build();
		}
	}

	@PostMapping("/fetch")
	public ResponseEntity<CaseDetails> fetchCase(@RequestParam String caseType, @RequestParam String caseNumber,
			@RequestParam String filingYear, @RequestParam String captcha) {
		CaseDetails details = service.fetchCaseDetails(caseType, caseNumber, filingYear, captcha);
		return ResponseEntity.ok(details);
	}
}
